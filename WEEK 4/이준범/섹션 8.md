# Section 8.

### 스프링 시큐리티 필터
- 기본적으로 스프링 시큐리티엔 수많은 필터들이 정의 돼있다.
- 그 필터들의 구조와 흐름을 알아야 적절한 위치에 적절한 로직을 지닌 커스텀 필터를 삽입할 수 있다.

### 커스텀 필터 작성하는 방법
- 커스텀 필터를 작성하기 위해서는 우선 Filter 인터페이스를 상속받아야한다.
- Filter 인터페이스를 상속받은 후 doFilter 메소드 내부에서 실행하고자하는 모든 로직을 정의하면 된다.
- doFilter 메소드의 인자로는 세가지가 있다.
  - 1. ServletRequest, 엔드유저로부터 오는 HTTP request이다.
    2. ServeletResponse, 엔드 유저에게 돌려보내는 HTTP response이다.
    3. filterChin, 필터들의 조합으로서 사용가능한 모든 필터로부터 다음 필터가 무엇인지 찾아내는 역할을 한다.

### 커스텀 필터를 어떻게 filterChain 내부에 주입할 수 있을까요?
- 세 가지 메소드로 주입이 가능하다.
  - 1. addFilterBefore(filter,class), 특정 class(filter) 이전 위치에 필터를 삽입시키는 메소드다.
    2. addFilterBefore(filter,class), 특정 class(filter) 이후 위치에 필터를 삽입시키는 메소드다.
    3. addFilterAt(filter, class), 특정 class 위치에 필터를 삽입시킨다.
    - 특정 위치에 삽입시키면 해당 위치에 있던 필터는 한 칸 뒤로 밀려나서 실행된다.
    - 사실상 addFilterBefore과 다름이 없다.
  - 위의 메소드들은 동일한 end matches, cors configuration, csrf configuraion을 지닌 곳에서만 실행돼야한다.

### Filter 인터페이스의 구조
```java
public interface Filter {
    default void init(FilterConfig filterConfig) throws ServletException {
    }

    void doFilter(ServletRequest var1, ServletResponse var2, FilterChain var3) throws IOException, ServletException;

    default void destroy() {
    }
}
```
- init 메소드는 처음 웹 애플리케이션이 실행되고 모든 필터들이 초기화 될때 실행되는 메소드이다.
- doFilter메소드는 필터가 호출될 때 실행되는 메소드로 이곳에 원하는 로직을 작성하면 된다.
- destroy메소드는 필터가 파괴될 때 실행되는 메소드이다.
