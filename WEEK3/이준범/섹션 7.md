# Section 7.

### 인증과 인가의 차이
- 인증은 사용자가 api에 접근이 가능한 사용잔가 아닌가를 구별하는 것이다.
- 인가란 권한부여로서 특정 api에 접근이 가능한 권한을 설정하여, 해당 권한이 있는 사람만 해당 api에 접근할 수 있도록 설정하는 것이다.
  - 항상 인증이 먼저 일어나고 그 이후에 인가가 발생한다.
  - 인증을 통해 로그인을 하고 어느 부분까지 접근할 수 있냐를 인가로 판단하는것이다.
- 인증에서는 아이디, 비밀번호, OTP 등의 정보를 필요로한다.
- 권한 부여에서는 자격증명관련 정보는 전혀 필요로 하지 않고, 역할이나 특권에 대한 정보만을 필요로한다.
- 인증 실패는 401 에러코드가 뜨고, 권한이 없을 시엔 403 에러코드가 발생한다.

### 유저의 권한과 역할이 저장되는 곳
```java
public interface GrantedAuthority extends Serializable {
    String getAuthority();
```
- 다음과 같이 GrantedAuthority라는 인터페이스가 있다.
- 이 GrantedAuthority의 구현체는 simpleGrantedAuthority이다.
- 권한 또는 역할을 부여하고 싶다면 simpleGrantedAuthority를 생성함과 동시에 인자에 문자열로 권한 혹은 역할을 넘겨줘야한다.
- 그러면 해당 내용이 simpleGrantedAuthority내부에 저장된다.
- 맨 처음 유저를 생성할 때 역할을 한 번 설정해주었다면 이후에 역할을 수정하는 방법은 존재하지 않는다.
- 그러면 권한 정보는 어디에 저장되는 것일까
``` java
if (passwordEncoder.matches(pwd, customer.get(0).getPwd())) {
                List<GrantedAuthority> authorities = new ArrayList<>();
                authorities.add(new SimpleGrantedAuthority(customer.get(0).getRole()));
                return new UsernamePasswordAuthenticationToken(username, pwd, authorities);
```
- 위의 코드는 우리가 만들었던 AuthenticationProvider다.
- 내부에 authorities를 저장하는 부분이있다.
- 맨 처음 유저를 생성할때 저장한 Role을 UsernamePasswordAuthenticationToken에 생성자로 넘겨준다.

- 한 가지 저장방법이 더 있다. User 객체 생성자에 authorities를 넘겨주는 것이다.
- 우리는 Authentication 토큰과 UserDetails 객체 두 가지에서 authorities를 얻어서 활용할 수 있다.

### 유저에게 여러가지 권한을 부여하는 방법
- 해당 강의에서 제시하는 방법은 다른 authorities 테이블을 생성하여 외래키로 연결시켜두는 방식이다.
- 질문???????????????????????????? 그냥 user 테이블에 리스트로 저장하면 되는거 아닌가?
